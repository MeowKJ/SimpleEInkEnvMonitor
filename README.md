![banner2.png](https://image.lceda.cn/pullimage/K0EeVsrXQP3DfGwQLachQURisxiBrE7BQpEHVpgk.png)

# **I. 项目总览**

| 特性     | 描述                           |
|:---:|:---:|
| 复刻难度 | ⭐️    |
| 成本     | ￥30-￥100                         |
| 主控     | ESP32C3                        |

> 这是一个简单又不缺实用的温湿度监测系统！这个系统基于ESP32-C3，还配备了一个2.13寸的墨水屏，可以实时显示环境的温湿度数据。这个项目旨在提供一种低功耗、实时更新的环境监测解决方案，特别适合家里或者办公室使用哦~

核心传感器食用的是盛思锐的SHT40传感器来采集温湿度数据，它具有高精度、低功耗和小尺寸的特点，非常适合用于各种环境监测应用。

Github上存放了本项目所有的软件资源。  
项目Github地址：[SimpleEInkEnvMonitor](https://github.com/MeowKJ/SimpleEInkEnvMonitor)
OSWHub上面存放了硬件设计资源。
项目OSWHHub地址：[小气象喵温湿度监测仪](https://oshwhub.com/kjpig/mini-sensor-board)


| 文件夹       | 作用                                   | 文件夹       | 作用                                       |
|--------------|----------------------------------------|--------------|--------------------------------------------|
| **1.Hardware** | 为空，请参考OSWHub  | **4.Docs**     | 包含文档文件，如数据手册和开发者指南       |
| **2.Firmware** | 为空，请参考Release栏目 | **5.Design**   | 包含设计相关文件，如UI设计和图标等|
| **3.Software** | 包含项目源代码 | **6.Tools**    | 包含工具和实用程序的工具   |

> *水平有限，以下有任何问题请在评论区指出*

# **II. 项目属性 & 开源协议**

该项目是首次公开，并且为原创项目，项目没有在其他比赛中获奖。

**GPL 3.0**  
[https://www.gnu.org/licenses/gpl-3.0.html](https://www.gnu.org/licenses/gpl-3.0.html)

# **III. 硬件部分**

> 硬件设计基于ESP32-C3-MINI-1-N4模块，温湿度来自盛思锐的SHT40，墨水屏建议2.13寸正好配合板子。

## **硬件概述**

这几天刚赶完，功耗没测不好说，但肯定不高的，这板子不小，建议上块大容量锂电池告别续航焦虑，可以把3d模型屁股做厚一点，搞块大电池。  
优化建议：
- AD得加个NMOS做个开关，或者直接不要。
- 那个RTC芯片直接不要了
- 软件优化
- 搞点微弱能量供应，我觉得搞点室内光小太阳能板说不定可以，毕竟她生命的绝大多数时间都该去睡觉。

## **材料说明**

### Ⅰ. 墨水屏
这也是我第一次做墨水屏，不知道市场价格怎么样，好像听说挺贵的。现在用的这个墨水屏是在某鱼上面找到个3色的，捡了几个，4.7元一个，邮费比屏贵。  
还有那种电子标签成品的更便宜，可惜买了一个没拆好把屏弄碎了。  
总之，颜色无所谓，改代码就行，是24Pin的就好。  
![墨水屏](https://image.lceda.cn/pullimage/1wwGr5C14zL0lejD0iQFHF30bSB36pGPB9v7Oga4.png)

### Ⅱ. 主控ESP32-MINI-1-N4
感觉不便宜，虽然不到十块钱，但不能说只要几块钱。  
焊接要注意一下，类似QFN那种铜在板子底部的封装，理论上焊接至少需要加热台或者是风枪。  
![ESP32-MINI-1-N4](https://image.lceda.cn/pullimage/V0fX6jaJIQrDKFEZzghWvMBkaBz0CHfUC2gRZlho.png)

### Ⅲ. 墨水屏的24Pin排线接子
注意是上接。那个屏幕折过来以后，接触铜朝外。

## **重要电路**

### Ⅰ. 墨水屏驱动
经典的墨水屏驱动电路，`BS`一般接地，需要修改`R2`和`L2`的值来面对不同型号的墨水屏。

![墨水屏驱动](https://image.lceda.cn/oshwhub/564ac04054db490dbd7697d6992c9a96.png)

### Ⅱ. 传感器
传感器的接线很简单，给它配了一颗电容。`SDA`和`SCL`使用`4.7KΩ`电阻上拉，满足IIC总线需求。

![传感器](https://image.lceda.cn/oshwhub/1b06867451294cc39fd9de45465705f7.png)

### Ⅲ. 电源切换
非常经典的电源切换电路，P型MOS管`Q4`在没有5V电源时MOS导通，此时系统由`VBAT`也就是锂电池供电。`Q4`有5V电源的时候截止，此时系统由`+5V`也就是USB供电，此时会为电池充电。

![电源切换](https://image.lceda.cn/oshwhub/8b57633bbd0744deb23051ebb93a0f56.png)

### Ⅳ. 锂电池充电和5V转3.3V
锂电池充电采用`TP4054`，TP4056的可爱版，`R15`用来配置充电电流为`500mA`。  
5V转3.3V需要注意，需要使用`低压差LDO`，常规LDO如AMS1117可能无法在接入锂电池（压差<1V）的情况下工作。ME6211的数据手册强调，它可以在压差为100mV的情况下同时提供100mA的最大输出电流$(100mV@Iout=100mA)$。ME6231数据手册上指出，它可以不要`C27`和`C29`这两颗100nF旁路电容，同时兼容陶瓷电容。我这里加上了有两个用意：1.兼容其他型号的LDO。2。我忘了可以不加。  
这里推荐可以换成DC-DC，也能增加效率，当然成本可能会略微高一点。

![锂电池充电和5V转3.3V](https://image.lceda.cn/oshwhub/4f5d1273e0d54098b2397f113762d5ee.png)

### Ⅴ. 其他一些说明
- USB上面的`5.1KΩ`电阻用来适配PD使其输出5V
- `IO9`也就是`BOOT`引脚上拉的那颗电阻可以不要，内部弱上拉
- 模组那里供电最好还是加几个电容，虽然模组内部是有的。但是参考设计上加了。

### Ⅵ. 一些疑问
- 关于ESP32的IO8，虽然数据手册上说进入`SPI DOWNLOAD`模式需要 `IO8 = 1`，但是我看到一些设计并没有主动上拉IO8

## **PCB说明**

> 东西不是很多，简单布局拉拉线就好了，没有太多需要注意的

### PCB的整体布局

元件封装以`0603`作为主要封装，适合手焊。整体PCB大小为2.13寸墨水屏大小，以全贴合为目标设计，背面没有元件。PCB剩余空间还是很大的，可以增加更多功能。器件供电应保持先过电容，再在到器件。同时，ESP32模块天部分和SHT40传感器下面做禁止铺铜处理。

![PCB的整体布局](https://image.lceda.cn/oshwhub/d619c7897b434c46bf3df4c08cbb561b.png)

# **IV. 软件部分**

> 软件使用了PlatformIO使用Arduino库进行开发，Board和Library已经集成好，克隆下来以后只要网络好，不需要像Arduino去配置板子等等繁琐的操作，可以直接编译成功，非常适合初学者进行二次开发。

## **软件概述**

| 使用到的库 | 版本 |
| --- | --- |
| adafruit/Adafruit SHT4x Library | ^1.0.4 |
| zinggjm/GxEPD2 | ^1.5.8 |
| olikraus/U8g2_for_Adafruit_GFX | ^1.8.0 |
| WiFi | Included |
| HTTPClient | Included |

## **代码结构**

在`src`文件夹中找到`main.cpp`作为主要代码文件，其他代码文件分为`Network`和`Display`两个文件夹。

**1. Network.cpp和Network.h**

包含主要的网络操作，如连接WIFI，发送HTTP GET请求等。需要按照你的项目需求在这些文件中进行具体配置和修改。

**2. Display.cpp和Display.h**

包含显示相关的代码文件，使用了Adafruit和GxEPD2库，负责墨水屏的绘制和显示操作。

**3. main.cpp**

主代码文件，执行初始化和主循环，负责整体的程序逻辑，包括温湿度的读取、显示和数据上传等功能。

## **编译与烧录**

请确保你的开发环境配置正确，使用PlatformIO打开项目后，选择对应的开发板型号和库文件，然后编译上传代码到ESP32-C3模块中即可。

# **V. 总结**

这是一个小巧实用的温湿度监测系统，适合各种应用场景。通过本项目，你可以学到如何使用ESP32-C3进行环境监测，以及如何将墨水屏应用于实时数据显示。希望你喜欢这个项目，并且能从中得到一些灵感。如果你有任何问题或建议，请在GitHub上提出，我会尽快回复你！

**文档更新：**  
- 2024年7月24日：完善了硬件、软件部分及电路图说明。
